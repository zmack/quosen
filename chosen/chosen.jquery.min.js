// Chosen, a Select Box Enhancer for jQuery and Protoype
// by Patrick Filler for Harvest, http://getharvest.com
// 
// Version 0.9.1
// Full source at https://github.com/harvesthq/chosen
// Copyright (c) 2011 Harvest http://getharvest.com

// MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md
// This file is generated by `cake build`, do not edit it by hand.
(function(){var e,t,n,r,i,s,o,u,a=function(e,t){return function(){return e.apply(t,arguments)}},f={}.hasOwnProperty,l=function(e,t){function r(){this.constructor=e}for(var n in t)f.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};u=this,e=jQuery,e.fn.extend({chosen:function(n){return!e.browser.msie||e.browser.version!=="6.0"&&e.browser.version!=="7.0"?e(this).each(function(r){if(!e(this).hasClass("chzn-done"))return new t(this,n)}):this}}),n=function(){function t(t,n){this.keydown_checker=a(this.keydown_checker,this),this.keyup_checker=a(this.keyup_checker,this),this.choices_click=a(this.choices_click,this),this.search_results_mouseout=a(this.search_results_mouseout,this),this.search_results_mouseover=a(this.search_results_mouseover,this),this.search_results_mouseup=a(this.search_results_mouseup,this),this.update_select_state=a(this.update_select_state,this),this.results_update_field=a(this.results_update_field,this),this.test_active_click=a(this.test_active_click,this),this.activate_field=a(this.activate_field,this),this.close_field=a(this.close_field,this),this.blur_test=a(this.blur_test,this),this.input_blur=a(this.input_blur,this),this.input_focus=a(this.input_focus,this),this.mouse_leave=a(this.mouse_leave,this),this.mouse_enter=a(this.mouse_enter,this),this.container_mousedown=a(this.container_mousedown,this),this.options=e.extend({display_search_box:e.fn.chosenDisplaySearch||!0},n),this.set_default_values(),this.form_field=t,this.$form_field=e(this.form_field),this.is_rtl=this.$form_field.hasClass("chzn-rtl"),this.set_up_html(),this.register_observers(),this.$form_field.addClass("chzn-done"),this.update_select_state()}return t.prototype.default_text=function(){return this.$form_field.data("placeholder")?this.$form_field.data("placeholder"):this.form_field.multiple?"Select Some Options":"Select an Option"},t.prototype.set_default_values=function(){return this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.result_single_selected=null,this.choices=0,this.results_none_found=this.options.no_results_text||"No results match"},t.prototype.container_id=function(){var e;return e=this.form_field.id.length?this.form_field.id.replace(/(:|\.)/g,"_"):this.generate_field_id(),e+="_chzn"},t.prototype.additional_container_classes=function(){return this.is_rtl?"chzn-rtl":""},t.prototype.build_container_div=function(){var t;return t=e("<div />",{id:this.container_id(),"class":"chzn-container "+this.additional_container_classes(),style:"width: "+this.f_width+"px"}),t.html(this.container_div_content())},t.prototype.set_up_html=function(){return this.f_width=this.$form_field.outerWidth(),this.$form_field.hide().after(this.build_container_div()),this.container=e("#"+this.container_id()),this.dropdown=this.container.find("div.chzn-drop").first(),this.set_container_class(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chzn-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.initialize_search_container(),this.results_build(),this.set_tab_index()},t.prototype.register_observers=function(){return this.container.mousedown(this.container_mousedown),this.container.mouseenter(this.mouse_enter),this.container.mouseleave(this.mouse_leave),this.search_results.mouseup(this.search_results_mouseup),this.search_results.mouseover(this.search_results_mouseover),this.search_results.mouseout(this.search_results_mouseout),this.$form_field.bind("liszt:updated",this.results_update_field),this.search_field.blur(this.input_blur),this.search_field.keyup(this.keyup_checker),this.search_field.keydown(this.keydown_checker)},t.prototype.container_mousedown=function(t){if(this.disabled)return;return t&&t.type==="mousedown"&&t.stopPropagation(),this.pending_destroy_click?this.pending_destroy_click=!1:(this.active_field?!this.is_multiple&&t&&(e(t.target)===this.selected_item||e(t.target).parents("a.chzn-single").length)&&(t.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),e(document).click(this.test_active_click),this.results_show()),this.activate_field())},t.prototype.select_item=function(t){var n,r;return r=this.results_data[t+""],n=this.option_id_for_index(r.array_index),this.selected_item.find("span").first().text(r.text),this.container.find("li.result-selected").removeClass("result-selected"),e("#"+n).addClass("result-selected")},t.prototype.mouse_enter=function(){return this.mouse_on_container=!0},t.prototype.mouse_leave=function(){return this.mouse_on_container=!1},t.prototype.input_focus=function(e){if(!this.active_field)return setTimeout(this.container_mousedown,50)},t.prototype.input_blur=function(e){if(!this.mouse_on_container)return this.active_field=!1,setTimeout(this.blur_test,100)},t.prototype.blur_test=function(e){if(!this.active_field&&this.container.hasClass("chzn-container-active"))return this.close_field()},t.prototype.close_field=function(){return e(document).unbind("click",this.test_active_click),this.is_multiple||(this.selected_item.attr("tabindex",this.search_field.attr("tabindex")),this.search_field.attr("tabindex",-1)),this.active_field=!1,this.results_hide(),this.container.removeClass("chzn-container-active"),this.winnow_results_clear(),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},t.prototype.activate_field=function(){if(this.disabled)return;return!this.is_multiple&&!this.active_field&&(this.search_field.attr("tabindex",this.selected_item.attr("tabindex")),this.selected_item.attr("tabindex",-1)),this.container.addClass("chzn-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},t.prototype.test_active_click=function(t){return e(t.target).parents("#"+this.container_id()).length?this.active_field=!0:this.close_field()},t.prototype.results_build=function(){var e,t,n,r,i;this.parsing=!0,this.results_data=u.SelectParser.select_to_array(this.form_field),this.is_multiple&&this.choices>0?(this.search_choices.find("li.search-choice").remove(),this.choices=0):this.is_multiple||this.selected_item.find("span").text(this.default_text()),e="",i=this.results_data;for(n=0,r=i.length;n<r;n++)t=i[n],t.group?e+=this.result_add_group(t):t.empty||(e+=this.result_add_option(t),t.selected&&this.is_multiple?this.choice_build(t):t.selected&&!this.is_multiple&&this.selected_item.find("span").text(t.text));return this.show_search_field_default(),this.search_field_scale(),this.search_results.html(e),this.parsing=!1},t.prototype.result_add_group=function(t){return t.disabled?"":(t.dom_id=this.container_id()+"_g_"+t.array_index,'<li id="'+t.dom_id+'" class="group-result">'+e("<div />").text(t.label).html()+"</li>")},t.prototype.option_id_for_index=function(e){return this.container_id()+"_o_"+e},t.prototype.result_add_option=function(e){var t;return e.disabled?"":(e.dom_id=this.option_id_for_index(e.array_index),t=e.selected&&this.is_multiple?[]:["active-result"],e.selected&&t.push("result-selected"),e.group_array_index!=null&&t.push("group-option"),'<li id="'+e.dom_id+'" class="'+t.join(" ")+'">'+e.html+"</li>")},t.prototype.results_update_field=function(){return this.result_clear_highlight(),this.result_single_selected=null,this.results_build(),this.update_select_state()},t.prototype.update_select_state=function(){return this.disabled=this.$form_field.attr("disabled")==="disabled",this.disabled?this.container.addClass("disabled"):this.container.removeClass("disabled")},t.prototype.result_do_highlight=function(e){var t,n,r,i,s;if(e.length){this.result_clear_highlight(),this.result_highlight=e,this.result_highlight.addClass("highlighted"),r=parseInt(this.search_results.css("maxHeight"),10),s=this.search_results.scrollTop(),i=r+s,n=this.result_highlight.position().top+this.search_results.scrollTop(),t=n+this.result_highlight.outerHeight();if(t>=i)return this.search_results.scrollTop(t-r>0?t-r:0);if(n<s)return this.search_results.scrollTop(n)}},t.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},t.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},t.prototype.results_show=function(){return this.results_showing=!0,this.update_dropdown_width(),this.dropdown.css({top:this.dropdown_top(),left:0}),this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results()},t.prototype.update_search_field_width=function(){return this.search_field.css({width:this.search_field_width()+"px"})},t.prototype.update_dropdown_width=function(){return this.dropdown.css({width:this.dropdown_width()+"px"})},t.prototype.update_dropdown_position=function(){return this.dropdown.css({top:this.dropdown_top()+"px"})},t.prototype.dropdown_top=function(){return this.container.height()},t.prototype.dropdown_width=function(){return this.f_width-s(this.dropdown)},t.prototype.results_hide=function(){return this.is_multiple||this.selected_item.removeClass("chzn-single-with-drop"),this.result_clear_highlight(),this.dropdown.css({left:"-9000px"}),this.results_showing=!1},t.prototype.add_new_option_and_select=function(e,t){var n;return n=jQuery("<option />"),n.text(e),n.val(t),n.appendTo(this.$form_field),this.results_update_field(),this.result_highlight=this.search_results.find("li:last-child"),this.result_select({metaKey:!0})},t.prototype.set_tab_index=function(){var e;if(!this.$form_field.attr("tabindex"))return;return e=this.$form_field.attr("tabindex"),this.$form_field.attr("tabindex",-1),this.update_selected_tab_index(e)},t.prototype.search_results_mouseup=function(e){var t;t=o(e);if(t.length)return this.result_highlight=t,this.result_select(e)},t.prototype.search_results_mouseover=function(e){var t;t=o(e);if(t)return this.result_do_highlight(t)},t.prototype.search_results_mouseout=function(t){if(e(t.target).hasClass("active-result"))return this.result_clear_highlight()},t.prototype.choices_click=function(t){t.preventDefault();if(this.active_field&&!e(t.target).hasClass("search-choice")&&!this.results_showing)return this.results_show()},t.prototype.choice_build=function(t){var n,r,i=this;return n=this.container_id()+"_c_"+t.array_index,this.choices+=1,this.search_container.before('<li class="search-choice" id="'+n+'">\n  <span>'+t.html+'</span>\n  <a href="javascript:void(0)" class="search-choice-close" rel="'+t.array_index+'"></a>\n</li>'),r=e("#"+n).find("a").first(),r.click(function(e){return i.choice_destroy_link_click(e)})},t.prototype.choice_destroy_link_click=function(t){return t.preventDefault(),this.pending_destroy_click=!0,this.choice_destroy(e(t.target))},t.prototype.choice_destroy=function(e){return this.choices-=1,this.show_search_field_default(),this.is_multiple&&this.choices>0&&this.search_field.val().length<1&&this.results_hide(),this.result_deselect(e.attr("rel")),e.parents("li").first().remove()},t.prototype.result_select=function(e){var t,n,r,i;if(this.result_highlight)return t=this.result_highlight,n=t.attr("id"),this.result_clear_highlight(),t.addClass("result-selected"),this.is_multiple?this.result_deactivate(t):this.result_single_selected=t,i=n.substr(n.lastIndexOf("_")+1),r=this.results_data[i],r.selected=!0,this.form_field.options[r.options_index].selected=!0,this.is_multiple?this.choice_build(r):this.selected_item.find("span").first().text(r.text),(!e.metaKey||!this.is_multiple)&&this.results_hide(),this.search_field.val(""),this.$form_field.trigger("change"),this.search_field_scale()},t.prototype.result_activate=function(e){return e.addClass("active-result").show()},t.prototype.result_deactivate=function(e){return e.removeClass("active-result").hide()},t.prototype.result_deselect=function(t){var n,r;return r=this.results_data[t],r.selected=!1,this.form_field.options[r.options_index].selected=!1,n=e("#"+this.container_id()+"_o_"+t),n.removeClass("result-selected").addClass("active-result").show(),this.result_clear_highlight(),this.winnow_results(),this.$form_field.trigger("change"),this.search_field_scale()},t.prototype.results_search=function(e){return this.results_showing?this.winnow_results():this.results_show()},t.prototype.winnow_results=function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;this.no_results_clear(),u=0,a=this.search_field.val()===this.default_text()?"":e("<div/>").text(e.trim(this.search_field.val())).html(),s=new RegExp(a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),v=this.results_data;for(c=0,p=v.length;c<p;c++){n=v[c];if(!n.disabled&&!n.empty)if(n.group)e("#"+n.dom_id).hide();else if(!this.is_multiple||!n.selected){t=!1,o=n.dom_id;if(s.test(n.html))t=!0,u+=1;else if(n.html.indexOf(" ")>=0||n.html.indexOf("[")===0){i=n.html.replace(/\[|\]/g,"").split(" ");if(i.length)for(h=0,d=i.length;h<d;h++)r=i[h],s.test(r)&&(t=!0,u+=1)}t?(a.length?(f=n.html.search(s),l=n.html.substr(0,f+a.length)+"</em>"+n.html.substr(f+a.length),l=l.substr(0,f)+"<em>"+l.substr(f)):l=n.html,e("#"+o).html!==l&&e("#"+o).html(l),this.result_activate(e("#"+o)),n.group_array_index!=null&&e("#"+this.results_data[n.group_array_index].dom_id).show()):(this.result_highlight&&o===this.result_highlight.attr("id")&&this.result_clear_highlight(),this.result_deactivate(e("#"+o)))}}return u<1&&a.length?this.no_results(a):this.winnow_results_set_highlight(),this.$form_field.trigger("liszt:results")},t.prototype.winnow_results_clear=function(){var t,n,r,i,s;this.search_field.val(""),n=this.search_results.find("li"),s=[];for(r=0,i=n.length;r<i;r++)t=n[r],t=e(t),t.hasClass("group-result")?s.push(t.show()):!this.is_multiple||!t.hasClass("result-selected")?s.push(this.result_activate(t)):s.push(void 0);return s},t.prototype.winnow_results_set_highlight=function(){var e,t;if(!this.result_highlight){t=this.is_multiple?[]:this.search_results.find(".result-selected"),e=t.length?t.first():this.search_results.find(".active-result").first();if(e!=null)return this.result_do_highlight(e)}},t.prototype.no_results=function(t){var n;return n=e('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),n.find("span").first().html(t),this.search_results.append(n)},t.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},t.prototype.keydown_arrow=function(){var t,n;this.result_highlight?this.results_showing&&(n=this.result_highlight.nextAll("li.active-result").first(),n&&this.result_do_highlight(n)):(t=this.search_results.find("li.active-result").first(),t&&this.result_do_highlight(e(t)));if(!this.results_showing)return this.results_show()},t.prototype.keyup_arrow=function(){var e;if(!this.results_showing&&!this.is_multiple)return this.results_show();if(this.result_highlight)return e=this.result_highlight.prevAll("li.active-result"),e.length?this.result_do_highlight(e.first()):(this.choices>0&&this.results_hide(),this.result_clear_highlight())},t.prototype.keydown_backstroke=function(){return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(this.pending_backstroke=this.search_container.siblings("li.search-choice").last(),this.pending_backstroke.addClass("search-choice-focus"))},t.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},t.prototype.keyup_checker=function(e){var t,n;if(this.disabled)return;t=(n=e.which)!=null?n:e.keyCode,this.search_field_scale();switch(t){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:e.preventDefault();if(this.results_showing)return this.result_select(e);break;case 27:if(this.results_showing)return this.results_hide();break;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},t.prototype.keydown_checker=function(e){var t,n;t=(n=e.which)!=null?n:e.keyCode,this.search_field_scale(),t!==8&&this.pending_backstroke&&this.clear_backstroke();switch(t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.mouse_on_container=!1;break;case 13:e.preventDefault();break;case 38:e.preventDefault(),this.keyup_arrow();break;case 40:this.keydown_arrow()}},t.prototype.search_field_scale=function(){},t.prototype.generate_field_id=function(){var e;return e=this.generate_random_id(),this.form_field.id=e,e},t.prototype.generate_random_id=function(){var t;t="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();while(e("#"+t).length>0)t+=this.generate_random_char();return t},t.prototype.generate_random_char=function(){var e,t,n;return e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ",n=Math.floor(Math.random()*e.length),t=e.substring(n,n+1)},t}(),i=function(e){function t(){return this.select_changed=a(this.select_changed,this),t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.is_multiple=!1,t.prototype.should_display_search_box=function(){var e;return e=this.options.display_search_box,typeof e=="function"?e(this):e},t.prototype.container_div_content=function(){return'<a href="javascript:void(0)" class="chzn-single">\n  <span>'+this.default_text()+'</span>\n  <div><b></b></div>\n</a>\n<div class="chzn-drop" style="left:-9000px;">\n  <div class="chzn-search">\n    <input type="text" autocomplete="off" />\n  </div>\n  <ul class="chzn-results"></ul>\n</div>'},t.prototype.initialize_search_container=function(){return this.search_container=this.container.find("div.chzn-search").first(),this.selected_item=this.container.find(".chzn-single").first()},t.prototype.search_field_width=function(){return this.dropdown_width()-s(this.search_container)-s(this.search_field)},t.prototype.register_observers=function(){return t.__super__.register_observers.apply(this,arguments),this.selected_item.focus(this.activate_field),this.$form_field.change(this.select_changed)},t.prototype.select_changed=function(e){return this.select_item(this.form_field.selectedIndex)},t.prototype.set_container_class=function(){return this.container.addClass("chzn-container-single")},t.prototype.update_selected_tab_index=function(e){return this.selected_item.attr("tabindex",e),this.search_field.attr("tabindex",-1)},t.prototype.results_show=function(){return this.selected_item.addClass("chzn-single-with-drop"),this.result_single_selected&&this.result_do_highlight(this.result_single_selected),this.update_search_field_width(),t.__super__.results_show.apply(this,arguments)},t.prototype.show_search_field_default=function(){this.search_field.val(""),this.search_field.removeClass("default");if(!this.should_display_search_box())return this.search_field.hide()},t.prototype.dropdown_top=function(){return this.container.height()-1},t}(n),r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return l(n,t),n.prototype.is_multiple=!0,n.prototype.container_div_content=function(){return'<ul class="chzn-choices">\n  <li class="search-field">\n    <input type="text" value="'+this.default_text()+'" class="default" autocomplete="off" style="width:25px;" />\n  </li>\n</ul>\n<div class="chzn-drop" style="left:-9000px;">\n  <ul class="chzn-results"></ul>\n</div>'},n.prototype.initialize_search_container=function(){return this.search_choices=this.container.find("ul.chzn-choices").first(),this.search_container=this.container.find("li.search-field").first()},n.prototype.register_observers=function(){return n.__super__.register_observers.apply(this,arguments),this.search_choices.click(this.choices_click),this.search_field.focus(this.input_focus)},n.prototype.set_container_class=function(){return this.container.addClass("chzn-container-multi")},n.prototype.update_selected_tab_index=function(e){return this.search_field.attr("tabindex",e)},n.prototype.show_search_field_default=function(){return this.choices<1&&!this.active_field?(this.search_field.val(this.default_text()),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},n.prototype.search_field_scale=function(){var t,n,r,i,s,o,u,a;n=0,o=0,i="position:absolute; left: -1000px; top: -1000px; display:none;",s=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(u=0,a=s.length;u<a;u++)r=s[u],i+=r+":"+this.search_field.css(r)+";";return t=e("<div />",{style:i}),t.text(this.search_field.val()),e("body").append(t),o=t.width()+25,t.remove(),o>this.f_width-10&&(o=this.f_width-10),this.search_field.css({width:o+"px"}),this.update_dropdown_position()},n.prototype.update_dropdown_width=function(){return this.dropdown.css({width:this.dropdown_width()+"px"})},n}(n),t=function(){function t(t,n){var s;return t.multiple?s=new r(t,n):s=new i(t,n),e(t).data("chosen",s),s}return t}(),o=function(t){return e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first()},s=function(e){return e.outerWidth()-e.width()},u.get_side_border_padding=s}).call(this),function(){var e;e=function(){function e(){this.options_index=0,this.parsed=[]}return e.prototype.add_node=function(e){return e.nodeName==="OPTGROUP"?this.add_group(e):this.add_option(e)},e.prototype.add_group=function(e){var t,n,r,i,s,o;t=this.parsed.length,this.parsed.push({array_index:t,group:!0,label:e.label,children:0,disabled:e.disabled}),s=e.childNodes,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(this.add_option(n,t,e.disabled));return o},e.prototype.add_option=function(e,t,n){if(e.nodeName==="OPTION")return e.text!==""?(t!=null&&(this.parsed[t].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,html:e.innerHTML,selected:e.selected,disabled:n===!0?n:e.disabled,group_array_index:t})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1},e}(),e.select_to_array=function(t){var n,r,i,s,o;r=new e,o=t.childNodes;for(i=0,s=o.length;i<s;i++)n=o[i],r.add_node(n);return r.parsed},this.SelectParser=e}.call(this)